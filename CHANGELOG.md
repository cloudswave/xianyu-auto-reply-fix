# 更新日志

## v1.2.3 (2026-02-08)

### 新功能
- **通知模板**: 新增通知模板自定义功能
  - 支持7种通知类型的模板自定义：消息通知、Token刷新异常、自动发货、滑块验证成功、人脸验证、密码登录成功、刷新Cookie成功
  - 在系统设置中可编辑各类通知的推送内容
  - 支持模板变量：{account_id}、{time}、{error_message} 等
  - 提供实时预览和测试发送功能
  - 支持一键重置为默认模板
- **暗色模式**: 新增跟随系统选项
  - 暗色模式切换支持三种模式：亮色、暗色、跟随系统
  - 跟随系统时自动响应系统主题变化

### 修复
- **通知推送**: 修复飞书通知签名验证失败的问题
  - 修正 HMAC-SHA256 签名算法，与实际发送逻辑保持一致
- **通知推送**: 修复通知内容重复显示账号ID和时间的问题
  - 移除 slider_patch.py 中多余的账号信息拼接

## v1.2.2 (2026-01-28)

### 修复
- **订单管理**: 修复商品ID提取错误的问题
  - 移除从 `message["1"]` 提取商品ID的逻辑（该字段是会话ID，不是商品ID）
  - 修复前：会话ID（如 `56226853668@goofish`）被误当作商品ID存入数据库
  - 修复后：只从正确的字段（如 `extension.itemId`、`bizData.itemId`）提取商品ID
  - 递归搜索时跳过会话ID字段和 `@goofish`/`@xianyu` 格式的字符串
- **订单管理**: 修复递归搜索误提取 tradeId 等非商品ID的问题
  - 移除对通用 `id` 字段的搜索（避免误提取 tradeId、bizId 等）
  - 只搜索明确命名为 `itemId` 或 `item_id` 的字段
  - 跳过 tradeId、bizId、orderId、userId 等已知非商品ID字段
  - 字符串中只从 `itemId=` URL参数提取，不再从任意数字提取

### 优化
- **订单管理**: 下单时自动获取并保存买家昵称
  - 从下单消息的 `senderNick` 字段提取买家昵称
  - 买家昵称在订单创建时就写入数据库，无需等待买家发消息后补全
- **暗色模式**: 修复页面刷新时的闪烁问题
  - 在 `<head>` 中提前执行主题检测脚本
  - 页面渲染前就设置好主题，避免亮色→暗色的闪烁

## v1.2.1 (2026-01-28)

### 新功能
- **暗色模式**: 新增暗色模式支持
  - 在侧边栏标题右侧添加暗色模式切换按钮
  - 点击月亮图标切换到暗色模式，点击太阳图标切换回亮色模式
  - 主题偏好自动保存到本地，刷新页面后保持设置
  - 全面适配卡片、表格、表单、弹窗等组件的暗色样式

## v1.2.0 (2026-01-28)

### 优化
- **滑块验证**: 重大优化重试策略，大幅提升重试成功率
  - 重试时刷新页面获取新的滑块挑战（之前在同一页面重试，成功率仅3-9%）
  - 大幅增加重试等待时间：第2次等待5-8秒，第3次等待8-12秒
  - 清除frame缓存强制重新检测滑块位置
  - 刷新失败时自动回退到点击重置方式

## v1.1.9 (2026-01-28)

### 修复
- **订单管理**: 修复交易关闭时订单状态不更新的问题
  - 收到"交易关闭"系统消息时，现在会正确调用订单状态处理器更新数据库
  - 修复前：交易关闭消息仅记录日志，不更新订单状态
  - 修复后：交易关闭的订单状态会同步到订单管理页面

## v1.1.8 (2026-01-28)

### 优化
- **滑块验证**: 优化滑块验证成功率
  - 扩大轨迹参数范围，模拟更真实的人类滑动行为
  - 调整重试策略：最大重试次数从5次减少到3次（因4-5次成功率极低）
  - 增加重试间隔时间：基础延迟从0.4秒增加到1.5秒
  - 优化策略权重：提升保守策略权重，降低激进策略权重
  - 重置策略统计数据以便重新学习

## v1.1.7 (2026-01-28)

### 新功能
- **菜单管理**: 新增拖拽排序功能
  - 按住拖动图标可调整菜单顺序
  - 菜单顺序自动保存到用户配置
  - 刷新页面后保持自定义顺序
- **版本信息**: 点击版本号可查看更新日志
  - 显示各版本新功能、优化和修复内容
  - 不同类型变更使用不同颜色图标区分

### 优化
- **侧边栏**: 使用CSS order属性实现菜单重排序，性能更优

### 修复
- **菜单排序**: 修复菜单排序后管理员功能和登出按钮位置错乱的问题
  - 管理员功能始终显示在普通菜单下方
  - 登出按钮始终显示在最底部

## v1.1.6 (2026-01-27)

### 新功能
- **菜单管理**: 新增侧边栏菜单显示/隐藏功能
  - 在系统设置中可自定义显示哪些菜单项
  - 仪表盘和系统设置为必选项，其他菜单可自由开关
  - 设置自动保存到用户配置，刷新后保持

## v1.1.5 (2026-01-27)

### 新功能
- **主题设置**: 新增主题颜色自定义功能
  - 提供9种预设颜色（靛蓝、紫罗兰、蓝色、青色、绿色、橙色、红色、粉色、灰色）
  - 支持颜色选择器自定义任意颜色
  - 支持直接输入颜色代码
  - 点击预设颜色即时预览效果

### 优化
- **系统设置**: 主题设置界面简化，操作更直观
- **系统设置**: 系统重启按钮移至页面标题栏右侧，布局更紧凑
- **系统设置**: 优化页面布局，主题设置与密码设置并排显示，登录与注册设置独占一行

## v1.1.4 (2026-01-27)

### 新功能
- **订单管理**: 新增买家昵称列，方便识别买家身份
- **订单管理**: 订单搜索支持按买家昵称搜索
- **自动补全**: 买家发送消息时自动补全该买家所有历史订单的昵称

### 优化
- **订单详情**: 订单详情弹窗中显示买家昵称信息
- **数据库**: 自动迁移添加 buyer_nick 字段

## v1.1.3 (2026-01-27)

### 优化
- **系统设置**: 优化"登录与注册设置"卡片布局
  - 增大各选项间距，提升视觉体验
  - 保存按钮使用大号样式并占满卡片宽度
  - 状态提示移至按钮上方显示，布局更合理

## v1.1.2 (2026-01-27)

### 优化
- **在线客服**: 修复页面底部白色空白区域问题，改用flex布局自适应高度
- **系统设置**: 重新组织页面布局
  - 第一行：密码设置（左）、登录与注册设置（右，管理员）
  - 第二行：主题设置（左）、系统重启（右，管理员）
- **系统设置**: 合并"注册设置"到"登录与注册设置"卡片中，统一管理
- **侧边栏**: 优化折叠功能，更新缓存版本号

## v1.1.1 (2026-01-27)

### 新功能
- **在线客服**: 优化账号密码显示布局，移至选择框旁边，采用上下两行显示
- **在线客服**: 刷新账号列表时自动重置账号密码显示
- **API**: cookies/details 接口新增返回 password 字段，支持在线客服功能

### 优化
- **UI**: 添加 favicon 图标，更新登录注册页面 Logo
- **配置**: 默认端口从 8080 修改为 8090，避免端口冲突

### 其他
- 删除不再使用的二维码图片文件

## v1.1.0 (2026-01-25)

### 新功能
- 添加登录页面验证码开关功能
- 优化订单管理功能
- 添加手动发货和刷新订单状态功能
- 完善双规格自动发货功能
- 添加手动重启功能

### 修复
- 修复自动发货模块语法错误导致账号无法启动的问题

## v1.0.0 (2026-01-24)

- 闲鱼自动回复系统初始版本
